<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnóstico Financeiro Pessoal - Assessoria Financeira</title>
    <!-- Incluindo a biblioteca SheetJS para gerar o Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* --- Estilos Gerais --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            background-color: #f4f7f9;
            color: #333;
            margin: 0;
            padding: 20px;
        }

        /* --- Container Principal --- */
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        /* --- Cabeçalho --- */
        header {
            background-color: #005a9c;
            color: #ffffff;
            padding: 30px;
            text-align: center;
        }
        header h1 { margin: 0; font-size: 2.2em; font-weight: 600; }
        header p { margin: 5px 0 0; font-size: 1.1em; opacity: 0.9; }

        /* --- Seções de Conteúdo --- */
        .material-section {
            padding: 30px;
            border-bottom: 1px solid #e0e5e9;
        }
        .material-section:last-child { border-bottom: none; }
        .material-section h2 {
            font-size: 1.8em;
            color: #004070;
            margin-top: 0;
            border-bottom: 2px solid #e0e5e9;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .material-section p { font-size: 1em; color: #555; }

        /* --- Estilos da Tabela (Material 1) --- */
        .financial-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }
        .financial-table th, .financial-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e5e9;
        }
        .financial-table thead th {
            background-color: #f0f4f7;
            font-weight: 600;
            color: #333;
        }
        
        .category-header td { background-color: #eaf2f8; font-weight: bold; color: #005a9c; }
        .subcategory-header td { background-color: #f8f9fa; font-weight: bold; }
        .item-detail td:first-child { padding-left: 30px; }
        .total-row td { background-color: #e9ecef; font-weight: bold; font-size: 1.05em; }

        .financial-table input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
            text-align: right;
            background-color: #fff;
        }
        .financial-table input[readonly] {
            border: none;
            font-weight: bold;
            color: #333;
            background-color: transparent;
        }
        .total-row input[readonly] {
             background-color: #e9ecef;
        }
        
        /* --- Estilos para Adicionar/Remover Linhas --- */
        .add-row-btn {
            background: none;
            border: 1px dashed #007bff;
            color: #007bff;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            transition: all 0.2s;
        }
        .add-row-btn:hover { background-color: #eaf2f8; }
        .delete-row-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            margin-left: 10px;
            line-height: 28px;
            text-align: center;
        }
        .input-with-delete { display: flex; align-items: center; }


        /* --- Botão Gerar Excel --- */
        .generate-button {
            display: block;
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .generate-button:hover { background-color: #218838; }
        
        /* --- ESTILOS DO GRÁFICO E TABELA (Material 2) --- */
        .analysis-container { display: flex; gap: 30px; margin-top: 25px; align-items: flex-end; flex-wrap: wrap; }
        .chart-container { flex: 1; min-width: 280px; padding-right: 20px; border-right: 1px solid #e0e5e9; }
        .chart { display: flex; justify-content: space-around; align-items: flex-end; height: 250px; padding: 10px; border: 1px solid #e0e5e9; border-radius: 5px; }
        .chart-bar-group { display: flex; flex-direction: column; align-items: center; width: 100px; }
        .chart-bar { width: 60px; height: 100%; background-color: #e9ecef; border-radius: 5px 5px 0 0; display: flex; flex-direction: column-reverse; overflow: hidden; }
        .chart-segment { width: 100%; transition: height 0.5s ease-out; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.8em; font-weight: bold; overflow: hidden; }
        .segment-essenciais { background-color: #007bff; }
        .segment-estilo-vida { background-color: #ffc107; }
        .segment-metas { background-color: #28a745; }
        .chart-label { margin-top: 10px; font-weight: bold; font-size: 0.9em; text-align: center; }
        .comparison-table-container { flex: 1.5; min-width: 300px; }
        .comparison-table { width: 100%; border-collapse: collapse; }
        .comparison-table th, .comparison-table td { padding: 10px; text-align: left; border-bottom: 1px solid #e0e5e9; }
        .comparison-table th { background-color: #f8f9fa; }
        .comparison-table td:nth-child(2), .comparison-table td:nth-child(3) { text-align: right; font-weight: bold; }
        .legend { display: flex; justify-content: center; gap: 20px; margin-top: 15px; font-size: 0.8em; }
        .legend-item { display: flex; align-items: center; }
        .legend-color { width: 12px; height: 12px; margin-right: 5px; border-radius: 3px; }

        /* --- Outros Estilos --- */
        .checklist{list-style:none;padding-left:0}.checklist h3{color:#004070;margin-top:25px;margin-bottom:10px}.checklist li{background-color:#f9f9f9;padding:15px;margin-bottom:8px;border-radius:5px;border-left:4px solid #005a9c;display:flex;align-items:center}.checklist li::before{content:'☐';font-size:1.5em;margin-right:15px;color:#005a9c}footer{text-align:center;padding:20px;font-size:.9em;color:#777}@media (max-width:768px){header h1{font-size:1.8em}.material-section h2{font-size:1.5em}.analysis-container{flex-direction:column;align-items:stretch}.chart-container{border-right:none;padding-right:0}}
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Diagnóstico Financeiro Pessoal</h1>
            <p>Sua Jornada para a Prosperidade Financeira - Coach Matheus</p>
        </header>

        <section class="material-section">
            <h2>Material 1: Diagnóstico Financeiro Completo</h2>
            <p>Preencha os campos em branco. Os totais e subtotais serão calculados automaticamente. Use a média dos últimos 3 meses para valores variáveis.</p>
            <table class="financial-table">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Subitem</th>
                        <th>Valor Mensal (R$)</th>
                    </tr>
                </thead>
                
                <tbody>
                    <tr class="category-header"><td colspan="3">1. Rendas Líquidas</td></tr>
                    <tr class="item-detail"><td>Renda PF</td><td>Salário Líquido (Emprego CLT 1)</td><td><input type="number" class="calcula-valor" data-category="renda" id="renda-salario-1" placeholder="0.00"></td></tr>
                    <tr class="item-detail"><td>Renda PF</td><td>Salário Líquido (Emprego CLT 2)</td><td><input type="number" class="calcula-valor" data-category="renda" id="renda-salario-2" placeholder="0.00"></td></tr>
                    <tr class="item-detail"><td>Renda PJ</td><td>Pró-Labore (se houver)</td><td><input type="number" class="calcula-valor" data-category="renda" id="renda-prolabore" placeholder="0.00"></td></tr>
                    <tr class="total-row"><td></td><td><strong>TOTAL DE RENDAS</strong></td><td><input type="text" id="total-rendas" readonly></td></tr>
                </tbody>

                <tbody>
                    <tr class="category-header"><td colspan="3">2. Despesas Pessoais</td></tr>
                    
                    <tr class="subcategory-header" style="background-color: #e6f0f7;"><td colspan="2">Gastos Essenciais</td><td><input type="text" id="subtotal-essenciais" readonly></td></tr>
                </tbody>
                <tbody id="essenciais-body">
                    <tr class="item-detail"><td>Moradia</td><td>Aluguel / Financiamento</td><td><input type="number" class="calcula-valor" data-group="essenciais" placeholder="0.00"></td></tr>
                    <tr class="item-detail"><td>Moradia</td><td>Condomínio</td><td><input type="number" class="calcula-valor" data-group="essenciais" placeholder="0.00"></td></tr>
                    <tr class="item-detail"><td>Contas</td><td>Luz, Água, Gás</td><td><input type="number" class="calcula-valor" data-group="essenciais" placeholder="0.00"></td></tr>
                    <tr class="item-detail"><td>Contas</td><td>Internet, TV, Celular</td><td><input type="number" class="calcula-valor" data-group="essenciais" placeholder="0.00"></td></tr>
                    <tr class="item-detail"><td>Saúde</td><td>Plano de Saúde</td><td><input type="number" class="calcula-valor" data-group="essenciais" placeholder="0.00"></td></tr>
                    <tr class="item-detail"><td>Saúde</td><td>Terapia / Psicólogo</td><td><input type="number" class="calcula-valor" data-group="essenciais" placeholder="0.00"></td></tr>
                    <tr class="item-detail"><td>Alimentação</td><td>Supermercado / Feira</td><td><input type="number" class="calcula-valor" data-group="essenciais" placeholder="0.00"></td></tr>
                </tbody>
                <tbody>
                    <tr><td colspan="3"><button type="button" class="add-row-btn" data-target-tbody="essenciais-body" data-group="essenciais">+ Adicionar item em Gastos Essenciais</button></td></tr>
                    <tr class="subcategory-header" style="background-color: #faf3e0;"><td colspan="2">Estilo de Vida</td><td><input type="text" id="subtotal-estilo-vida" readonly></td></tr>
                </tbody>
                <tbody id="estilo-vida-body">
                    <tr class="item-detail"><td>Alimentação</td><td>Restaurantes / Delivery</td><td><input type="number" class="calcula-valor" data-group="estilo-vida" placeholder="0.00"></td></tr>
                    <tr class="item-detail"><td>Transporte</td><td>Combustível / Manutenção</td><td><input type="number" class="calcula-valor" data-group="estilo-vida" placeholder="0.00"></td></tr>
                    <tr class="item-detail"><td>Transporte</td><td>Apps (Uber, 99) / Transporte Público</td><td><input type="number" class="calcula-valor" data-group="estilo-vida" placeholder="0.00"></td></tr>
                    <tr class="item-detail"><td>Lazer</td><td>Academia, Hobbies, Compras</td><td><input type="number" class="calcula-valor" data-group="estilo-vida" placeholder="0.00"></td></tr>
                </tbody>
                <tbody>
                    <tr><td colspan="3"><button type="button" class="add-row-btn" data-target-tbody="estilo-vida-body" data-group="estilo-vida">+ Adicionar item em Estilo de Vida</button></td></tr>
                </tbody>

                <tbody>
                    <tr class="category-header"><td colspan="3">3. Resumo Financeiro</td></tr>
                    <tr class="total-row" style="background-color: #e9ecef;"><td></td><td><strong>Total da Renda</strong></td><td><input type="text" id="resumo-total-renda" readonly></td></tr>
                    <tr class="total-row" style="background-color: #f8d7da; color: #721c24;"><td></td><td><strong>Total de Despesas</strong></td><td><input type="text" id="total-despesas" readonly></td></tr>
                    <tr class="total-row" style="background-color: #d4edda; color: #155724;"><td></td><td><strong>Disponível para investimento</strong></td><td><input type="text" id="fluxo-caixa" readonly></td></tr>
                </tbody>
            </table>
            <button id="gerar-excel-btn" class="generate-button">Gerar Planilha Excel com Resumo</button>
        </section>

        <section class="material-section">
            <h2>Material 2: Análise do Orçamento 50/30/20</h2>
            <p>Veja uma comparação visual de como suas despesas atuais se alinham ao modelo de orçamento 50/30/20, com base na sua renda total.</p>
            
            <div class="analysis-container">
                <div class="chart-container">
                    <div class="chart">
                        <div class="chart-bar-group">
                            <div class="chart-bar" id="bar-atual">
                                <div class="chart-segment segment-metas" id="segment-atual-metas"></div>
                                <div class="chart-segment segment-estilo-vida" id="segment-atual-estilo"></div>
                                <div class="chart-segment segment-essenciais" id="segment-atual-essenciais"></div>
                            </div>
                            <div class="chart-label">Sua Situação Atual</div>
                        </div>
                        <div class="chart-bar-group">
                            <div class="chart-bar">
                                <div class="chart-segment segment-metas" style="height: 20%;">20%</div>
                                <div class="chart-segment segment-estilo-vida" style="height: 30%;">30%</div>
                                <div class="chart-segment segment-essenciais" style="height: 50%;">50%</div>
                            </div>
                            <div class="chart-label">Situação Ideal</div>
                        </div>
                    </div>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-color segment-essenciais"></div>Essenciais</div>
                        <div class="legend-item"><div class="legend-color segment-estilo-vida"></div>Estilo de Vida</div>
                        <div class="legend-item"><div class="legend-color segment-metas"></div>Metas</div>
                    </div>
                </div>
                <div class="comparison-table-container">
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Categoria</th>
                                <th>Valor Atual</th>
                                <th>Valor Ideal</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Gastos Essenciais</td>
                                <td id="comp-atual-essenciais">R$ 0,00</td>
                                <td id="comp-ideal-essenciais">R$ 0,00</td>
                            </tr>
                            <tr>
                                <td>Estilo de Vida</td>
                                <td id="comp-atual-estilo">R$ 0,00</td>
                                <td id="comp-ideal-estilo">R$ 0,00</td>
                            </tr>
                            <tr>
                                <td>Metas Financeiras</td>
                                <td id="comp-atual-metas">R$ 0,00</td>
                                <td id="comp-ideal-metas">R$ 0,00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section class="material-section">
            <h2>Material 3: Checklist para Organização</h2>
            <p>Siga estas dicas para manter suas finanças sempre em ordem.</p>
            <ul class="checklist">
                <h3>Ações Imediatas</h3>
                <li>Revisar faturas e extratos dos últimos 3 meses.</li>
                <li>Definir um dia fixo no mês para pagar contas.</li>
                <li>Criar pastas (físicas ou digitais) para organizar comprovantes.</li>
                <h3>Monitoramento Contínuo</h3>
                <li>Acompanhar o orçamento semanalmente.</li>
                <li>Reavaliar metas e despesas a cada 3 meses.</li>
                <li>Evitar compras por impulso e sempre pesquisar preços.</li>
            </ul>
        </section>

        <footer>
            <p>Este material é o primeiro passo da nossa jornada. Estou à disposição para esclarecer qualquer dúvida.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const table = document.querySelector('.financial-table');
            const formatadorMoeda = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });

            function atualizarTodosOsCalculos() {
                let totais = { renda: 0, essenciais: 0, 'estilo-vida': 0 };
                const todosOsInputs = table.querySelectorAll('.calcula-valor');

                todosOsInputs.forEach(input => {
                    const valor = parseFloat(input.value) || 0;
                    const categoria = input.dataset.category;
                    const grupo = input.dataset.group;

                    if (totais.hasOwnProperty(categoria)) totais[categoria] += valor;
                    if (totais.hasOwnProperty(grupo)) totais[grupo] += valor;
                });

                const totalRendas = totais.renda;
                const totalDespesas = totais.essenciais + totais['estilo-vida'];
                const fluxoDeCaixa = totalRendas - totalDespesas;

                document.getElementById('total-rendas').value = formatadorMoeda.format(totalRendas);
                document.getElementById('subtotal-essenciais').value = formatadorMoeda.format(totais.essenciais);
                document.getElementById('subtotal-estilo-vida').value = formatadorMoeda.format(totais['estilo-vida']);
                document.getElementById('resumo-total-renda').value = formatadorMoeda.format(totalRendas);
                document.getElementById('total-despesas').value = formatadorMoeda.format(totalDespesas);
                document.getElementById('fluxo-caixa').value = formatadorMoeda.format(fluxoDeCaixa);

                const idealEssenciais = totalRendas * 0.5;
                const idealEstiloVida = totalRendas * 0.3;
                const idealMetas = totalRendas * 0.2;
                
                const atualEssenciais = totais.essenciais;
                const atualEstiloVida = totais['estilo-vida'];
                const atualMetas = fluxoDeCaixa;

                document.getElementById('comp-atual-essenciais').innerText = formatadorMoeda.format(atualEssenciais);
                document.getElementById('comp-ideal-essenciais').innerText = formatadorMoeda.format(idealEssenciais);
                document.getElementById('comp-atual-estilo').innerText = formatadorMoeda.format(atualEstiloVida);
                document.getElementById('comp-ideal-estilo').innerText = formatadorMoeda.format(idealEstiloVida);
                document.getElementById('comp-atual-metas').innerText = formatadorMoeda.format(atualMetas);
                document.getElementById('comp-ideal-metas').innerText = formatadorMoeda.format(idealMetas);

                const percEssenciais = totalRendas > 0 ? (atualEssenciais / totalRendas) * 100 : 0;
                const percEstiloVida = totalRendas > 0 ? (atualEstiloVida / totalRendas) * 100 : 0;
                const percMetas = totalRendas > 0 ? (atualMetas / totalRendas) * 100 : 0;
                
                const segEssenciais = document.getElementById('segment-atual-essenciais');
                const segEstilo = document.getElementById('segment-atual-estilo');
                const segMetas = document.getElementById('segment-atual-metas');

                segEssenciais.style.height = `${Math.max(0, percEssenciais)}%`;
                segEstilo.style.height = `${Math.max(0, percEstiloVida)}%`;
                segMetas.style.height = `${Math.max(0, percMetas)}%`;

                segEssenciais.innerText = percEssenciais > 10 ? `${Math.round(percEssenciais)}%` : '';
                segEstilo.innerText = percEstiloVida > 10 ? `${Math.round(percEstiloVida)}%` : '';
                segMetas.innerText = percMetas > 10 ? `${Math.round(percMetas)}%` : '';
            }

            // --- LÓGICA DE EVENTOS (Adicionar, Remover, Calcular) ---
            table.addEventListener('click', function(event) {
                // Botão de Adicionar Linha
                if (event.target.classList.contains('add-row-btn')) {
                    const targetTbodyId = event.target.dataset.targetTbody;
                    const group = event.target.dataset.group;
                    const targetTbody = document.getElementById(targetTbodyId);
                    
                    const newRow = document.createElement('tr');
                    newRow.classList.add('item-detail');
                    newRow.innerHTML = `
                        <td><input type="text" placeholder="Novo item" class="item-name-input"></td>
                        <td><input type="text" placeholder="Descrição (opcional)" class="subitem-name-input"></td>
                        <td>
                            <div class="input-with-delete">
                                <input type="number" class="calcula-valor" data-group="${group}" placeholder="0.00">
                                <button type="button" class="delete-row-btn" title="Remover linha">×</button>
                            </div>
                        </td>
                    `;
                    targetTbody.appendChild(newRow);
                }

                // Botão de Remover Linha
                if (event.target.classList.contains('delete-row-btn')) {
                    event.target.closest('tr').remove();
                    atualizarTodosOsCalculos();
                }
            });

            // Evento para recalcular ao digitar
            table.addEventListener('input', function(event) {
                if (event.target.classList.contains('calcula-valor')) {
                    atualizarTodosOsCalculos();
                }
            });

            // --- LÓGICA PARA GERAR EXCEL ---
            document.getElementById('gerar-excel-btn').addEventListener('click', function() {
                let data = [];
                const tableRows = table.querySelectorAll('tbody > tr');

                tableRows.forEach(row => {
                    // Ignora as linhas que contêm os botões "+ Adicionar"
                    if (row.querySelector('.add-row-btn')) {
                        return;
                    }

                    const cols = row.cells;
                    let col1 = '', col2 = '', col3 = '';

                    // Processa a primeira coluna
                    if (cols[0]) {
                        const input = cols[0].querySelector('input');
                        col1 = input ? input.value : cols[0].innerText;
                    }
                    
                    // Processa a segunda coluna
                    if (cols[1]) {
                        const input = cols[1].querySelector('input');
                        col2 = input ? input.value : cols[1].innerText;
                    }

                    // Processa a terceira coluna
                    if (cols[2]) {
                        const input = cols[2].querySelector('input');
                        col3 = input ? input.value : '';
                    }
                    
                    data.push([col1, col2, col3]);
                });
                
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.aoa_to_sheet(data);
                XLSX.utils.book_append_sheet(wb, ws, "Diagnostico Financeiro");
                XLSX.writeFile(wb, "Diagnostico_Financeiro_Pessoal.xlsx");
            });

            // Roda os cálculos uma vez no início para formatar os campos zerados
            atualizarTodosOsCalculos();
        });
    </script>

</body>
</html>
